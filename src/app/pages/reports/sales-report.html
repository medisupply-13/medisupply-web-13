<app-page-header [pageTitle]="pageTitle" [backRoute]="'/reportes'"></app-page-header>

<div class="report-container">
  <app-custom-select
    [labelKey]="'salesReportVendorLabel'"
    [options]="vendedores()"
    [model]="vendedor"
    [required]="true"
    [maxOptionsHeight]="320"
    (modelChange)="onSelectionChange()"
  ></app-custom-select>

  <app-custom-select
    [labelKey]="'salesReportPeriodLabel'"
    [options]="periodos"
    [model]="periodo"
    [required]="true"
    (modelChange)="onSelectionChange()"
    style="margin-top: 20px"
  ></app-custom-select>

  <div class="button-container">
    <button mat-flat-button color="primary" [disabled]="isButtonDisabled" (click)="generarReporte()">
      {{ 'salesReportButton' | translate }}
    </button>
  </div>

  <app-status-message
    *ngIf="showMessage()"
    [type]="messageType()"
    [messageKey]="messageText()"
    [float]="true"
    [duration]="messageType() === 'error' ? 8000 : 4000"
  ></app-status-message>

  <div *ngIf="reportData()" class="report-result">
    <div class="period-info">
      <h3>{{ 'salesReportPeriod' | translate }}: {{ getTranslatedPeriod(reportData().period_type) }}</h3>
      <p class="period-dates">{{ reportData().periodo }}</p>
    </div>
    
    <div class="summary">
      <div class="box">
        <h3>{{ 'salesReportTotalSales' | translate }}</h3>
        <p>{{ reportData().ventasTotales | currency:currencySymbol():'symbol':'1.0-0' }}</p>
      </div>
      <div class="box">
        <h3>{{ 'salesReportOrders' | translate }}</h3>
        <p>{{ reportData().pedidos }}</p>
      </div>
    </div>

    <table class="sales-table">
      <thead>
        <tr>
          <th>{{ 'salesReportProduct' | translate }}</th>
          <th>{{ 'salesReportAmount' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of reportData().productos; trackBy: trackByProduct">
          <td>{{ p.nombre }}</td>
          <td>{{ p.ventas | currency:currencySymbol():'symbol':'1.0-0' }}</td>
        </tr>
      </tbody>
    </table>

    <div class="chart">
      <h3>{{ 'salesReportTrend' | translate }}</h3>
      <p class="chart-subtitle">{{ getChartSubtitle() }}</p>
    
      <ngx-charts-line-chart
        [view]="getChartView()"
        [scheme]="'cool'"
        [results]="getChartData()"
        [xAxis]="true"
        [yAxis]="true"
        [legend]="false"
        [showXAxisLabel]="true"
        [showYAxisLabel]="true"
        [xAxisLabel]="getXAxisLabel()"
        [yAxisLabel]="'salesReportChartYAxisLabel' | translate"
        [animations]="false"
        [curve]="curveLinear"
        [showGridLines]="true"
        [roundDomains]="true"
        [autoScale]="true">
      </ngx-charts-line-chart>
    </div>
    
    
  </div>
</div>
